{% extends "dashboard/layout.html" %}

{% block title %}Invoices - Sync Dashboard{% endblock %}
{% block page_title %}Invoices{% endblock %}

{% block content %}
<div class="bg-white shadow rounded-lg p-6">
  <h2 class="text-lg font-semibold mb-4">Invoices</h2>

  <table id="invoices-table" class="w-full table-auto border-collapse border border-gray-200">
    <thead>
      <tr class="bg-gray-100 text-left">
        <th class="p-2 border">#</th>
        <th class="p-2 border">Reg No</th>
        <th class="p-2 border">Reference</th>
        <th class="p-2 border">Balance</th>
        <th class="p-2 border">Invoice Date</th>
        <th class="p-2 border">QBO Status</th>
        <th class="p-2 border">Pushed By</th>
        <th class="p-2 border">Pushed Date</th>
      </tr>
    </thead>
    <tbody>
      <!-- DataTables will populate rows here -->
    </tbody>
  </table>
</div>

{% endblock %}

{% block scripts %}
<script>
  $(document).ready(function() {
    $('#invoices-table').DataTable({
      processing: true,
      serverSide: true,
      ajax: {
        url: "{{ url_for('invoices_bp.get_mis_invoices') }}",
        type: 'GET'
      },
      columns: [
        { data: 'id' },
        { data: 'reg_no' },
        { data: 'reference_number', defaultContent: '-' },
        { data: 'balance', defaultContent: 0 },
        { data: 'invoice_date', defaultContent: '-' },
        { 
          data: 'QuickBk_Status',
          render: function(data) {
            if (data === 1) return '<span class="text-green-600 font-semibold">Synced</span>';
            if (data === 2) return '<span class="text-red-600 font-semibold">Failed</span>';
            return '<span class="text-yellow-600 font-semibold">Pending</span>';
          }
        },
        { data: 'pushed_by', defaultContent: '-' },
        { data: 'pushed_date', defaultContent: '-' }
      ],
      order: [[4, 'desc']], // sort by invoice_date descending
      pageLength: 50,
      lengthMenu: [10, 25, 50, 100],
      responsive: true,
      language: {
        processing: "Loading invoices...",
        emptyTable: "No invoices found",
        search: "Search:",
        lengthMenu: "Show _MENU_ invoices",
        info: "Showing _START_ to _END_ of _TOTAL_ invoices",
        infoEmpty: "No invoices available",
        paginate: {
          first: "First",
          last: "Last",
          next: "Next",
          previous: "Prev"
        }
      }
    });
  });
</script>
{% endblock %}
