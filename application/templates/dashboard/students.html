{% extends "dashboard/layout.html" %}

{% block title %}Students - Dashboard{% endblock %}
{% block page_title %}Students{% endblock %}

{% block content %}
<div class="bg-white shadow rounded-lg p-6">
  <h2 class="text-lg font-semibold mb-4">Students</h2>
    <table id="students-table" class="w-full table-auto border-collapse border border-gray-200">
        <thead>
        <tr class="bg-gray-100 text-left">
            <th class="border border-gray-200 px-4 py-2">ID</th>
            <th class="border border-gray-200 px-4 py-2">Reg No</th>
            <th class="border border-gray-200 px-4 py-2">First Name</th>
            <th class="border border-gray-200 px-4 py-2">Last Name</th>
            <th class="border border-gray-200 px-4 py-2">Email</th>
            <th class="border border-gray-200 px-4 py-2">Phone</th>
            <th class="border border-gray-200 px-4 py-2">QBO Status</th>
            <th class="border border-gray-200 px-4 py-2">Pushed By</th>
            <th class="border border-gray-200 px-4 py-2">Pushed Date</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- DataTables Scripts -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script>
$(document).ready(function() {
    $('#students-table').DataTable({
        processing: true,
        serverSide: true,
        ajax: {
            url: '/students/get_students', // Fixed endpoint
            type: 'GET'
        },
        columns: [
            { data: 'per_id_ug' },
            { data: 'reg_no' },
            { data: 'fname', defaultContent: '-' },
            { data: 'lname', defaultContent: '-' },
            { data: 'email1', defaultContent: '-' },
            { data: 'phone1', defaultContent: '-' },
            { data: 'quickbooks_status',
              render: function(data) {
                if (data == 1) {
                  return '<span class="text-green-600 bg-green-100 px-2 py-1 rounded-md text-sm font-medium">Synced</span>';
                }
                if (data == 2) {
                  return '<span class="text-red-600 bg-red-100 px-2 py-1 rounded-md text-sm font-medium">Failed</span>';
                }
                return '<span class="text-yellow-600 bg-yellow-100 px-2 py-1 rounded-md text-sm font-medium">Unsynced</span>';
              }
            },
            { data: 'pushed_by', defaultContent: '-' },
            { data: 'pushed_date', defaultContent: '-' }
        ]
    });
});
</script>
{% endblock %}