{% extends "dashboard/layout.html" %}

{% block content %}
<div class="p-6 bg-white rounded-lg shadow">
    <h2 class="text-2xl font-semibold mb-4">MIS Invoices</h2>

    <!-- Live Search Input -->
    <div class="mb-4">
        <input type="text" id="invoice-search" placeholder="Search invoices..." 
               class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring focus:border-blue-300">
    </div>

    <table id="mis-invoices-table" class="stripe hover w-full">
        <thead>
            <tr>
                <th>ID</th>
                <th>Registration No</th>
                <th>Date</th>
                <th>Balance</th>
                <th>Student Name</th>
                <th>Applicant Name</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- DataTables JS and CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<script>
$(document).ready(function() {
    // Initialize DataTable
    const table = $('#mis-invoices-table').DataTable({
        processing: true,
        serverSide: true,
        ajax: {
            url: '/api/v1/mis-invoices/',
            type: 'GET',
            dataSrc: function(json) {
                if (json.error) {
                    alert('Error: ' + json.error);
                    return [];
                }
                return json.data;
            }
        },
        columns: [
            { data: 'id' },
            { data: 'reg_no' },
            { data: 'date' },
            { data: 'balance', render: $.fn.dataTable.render.number(',', '.', 2, '$') },
            { data: 'student_name' },
            { data: 'applicant_name' }
        ],
        order: [[2, 'desc']],
        pageLength: 25,
        lengthMenu: [10, 25, 50, 100],
        responsive: true,
        language: {
            emptyTable: "No invoices found from January 1, 2025."
        }
    });

    // Live search filter
    $('#invoice-search').on('keyup', function() {
        table.search(this.value).draw();
    });
});
</script>
{% endblock %}
