{% extends "dashboard/layout.html" %}
{% block content %}

<div class="p-6 bg-white rounded-lg shadow">
    <h2 class="text-2xl font-bold mb-4">Invoices (From Jan 1, 2025)</h2>

    <table id="invoices-table" class="min-w-full table-auto text-sm text-left text-gray-700">
        <thead class="bg-gray-100 uppercase text-gray-600">
            <tr>
                <th class="px-4 py-2">ID</th>
                <th class="px-4 py-2">Reg No</th>
                <th class="px-4 py-2">Date</th>
                <th class="px-4 py-2">Balance</th>
                <th class="px-4 py-2">Student</th>
                <th class="px-4 py-2">Applicant</th>
            </tr>
        </thead>
        <tbody>
            <!-- DataTables will populate rows via AJAX -->
        </tbody>
    </table>
</div>

<!-- DataTables CSS & JS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<script>
$(document).ready(function() {
    $('#invoices-table').DataTable({
        ajax: {
            url: '/api/invoices',  // Flask API endpoint
            dataSrc: 'invoices',    // JSON key containing invoice list
            data: function(d) {
                // Optional: send additional params like from_date
                d.from_date = '2025-01-01';
            }
        },
        columns: [
            { data: 'id' },
            { data: 'reg_no' },
            { 
                data: 'date',
                render: function(data) {
                    return data ? data.split('T')[0] : '-';
                }
            },
            { data: 'balance' },
            { data: 'student_name', defaultContent: '-' },
            { data: 'applicant_name', defaultContent: '-' }
        ],
        pageLength: 10,
        responsive: true,
        processing: true,
        serverSide: true  // Optional: enable if backend supports paginated queries
    });
});
</script>

{% endblock %}
